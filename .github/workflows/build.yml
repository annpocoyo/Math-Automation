name: PyInstaller Build
run-name: ${{ github.ref }} triggered build for repo.
on: [push, workflow_call]
jobs:
  build-windows:
    runs-on: windows-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4
      - name: Setup Python
        uses: actions/setup-python@v5.4.0
        with:
          # Version range or exact version of Python or PyPy to use, using SemVer's version range syntax. Reads from .python-version if unset.
          python-version: '3.11'
          # The target architecture (x86, x64, arm64) of the Python or PyPy interpreter.
          architecture: x64
          # Caching
          cache: 'pip'
          cache-dependency-path: '${{ github.workspace }}/requirements-ghactions.txt'
      - name: Install selenium and pyinstaller
        run: pip install -r "${{ github.workspace }}/requirements-ghactions.txt"
      - name: Run pyinstaller
        working-directory: ${{ github.workspace }}
        run: pyinstaller  "--paths=${{ github.workspace }}/Library" -F -n auto-mathletics-windows "${{ github.workspace }}/automathletics.py"
      - name: Upload artifact to GitHub actions
        uses: actions/upload-artifact@v4
        with:
          # Name of the artifact to upload.
          # Optional. Default is 'artifact'
          name: auto-mathletics-windows
      
          # A file, directory or wildcard pattern that describes what to upload
          # Required.
          path: ${{ github.workspace }}/dist/*
  build-macos:
    runs-on: macos-13
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4
      - name: Setup Python
        uses: actions/setup-python@v5.4.0
        with:
          # Version range or exact version of Python or PyPy to use, using SemVer's version range syntax. Reads from .python-version if unset.
          python-version: '3.11'
          # The target architecture (x86, x64, arm64) of the Python or PyPy interpreter.
          architecture: x64
          # Caching
          cache: 'pip'
          cache-dependency-path: '${{ github.workspace }}/requirements-ghactions.txt'
      - name: Install selenium and pyinstaller
        run: pip install -r "${{ github.workspace }}/requirements-ghactions.txt"
      - name: Run pyinstaller
        working-directory: ${{ github.workspace }}
        run: pyinstaller  "--paths=${{ github.workspace }}/Library" -F -n auto-mathletics-macos "${{ github.workspace }}/automathletics.py"
      - name: Upload artifact to GitHub actions
        uses: actions/upload-artifact@v4
        with:
          # Name of the artifact to upload.
          # Optional. Default is 'artifact'
          name: auto-mathletics-macos
      
          # A file, directory or wildcard pattern that describes what to upload
          # Required.
          path: ${{ github.workspace }}/dist/*
